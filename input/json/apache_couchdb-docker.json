{"docker":[{"name":"FROM","lineno":13,"args":"debian:buster-slim","raw":"FROM debian:buster-slim"},{"name":"LABEL","lineno":15,"args":{"maintainer":"\"CouchDB Developers dev@couchdb.apache.org\""},"raw":"LABEL maintainer=\"CouchDB Developers dev@couchdb.apache.org\""},{"name":"RUN","lineno":18,"args":"groupadd -g 5984 -r couchdb && useradd -u 5984 -d /opt/couchdb -g couchdb couchdb","raw":"RUN groupadd -g 5984 -r couchdb && useradd -u 5984 -d /opt/couchdb -g couchdb couchdb"},{"name":"RUN","lineno":29,"args":"set -ex;     apt-get update;     apt-get install -y --no-install-recommends         apt-transport-https         ca-certificates         dirmngr         gnupg      ;     rm -rf /var/lib/apt/lists/*","raw":"RUN set -ex;     apt-get update;     apt-get install -y --no-install-recommends         apt-transport-https         ca-certificates         dirmngr         gnupg      ;     rm -rf /var/lib/apt/lists/*"},{"name":"ENV","lineno":33,"args":{"GOSU_VERSION":"1.11"},"raw":"ENV GOSU_VERSION 1.11"},{"name":"ENV","lineno":34,"args":{"TINI_VERSION":"0.18.0"},"raw":"ENV TINI_VERSION 0.18.0"},{"name":"RUN","lineno":43,"args":"set -ex;         apt-get update;     apt-get install -y --no-install-recommends wget;     rm -rf /var/lib/apt/lists/*;         dpkgArch=\"$(dpkg --print-architecture | awk -F- '{ print $NF }')\";     # install gosu","raw":"RUN set -ex;         apt-get update;     apt-get install -y --no-install-recommends wget;     rm -rf /var/lib/apt/lists/*;         dpkgArch=\"$(dpkg --print-architecture | awk -F- '{ print $NF }')\";     # install gosu"},{"name":"WGET","lineno":59,"args":"-O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/${GOSU_VERSION}/gosu-$dpkgArch\";     wget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\";     export GNUPGHOME=\"$(mktemp -d)\";     echo \"disable-ipv6\" >> ${GNUPGHOME}/dirmngr.conf;     for server in $(shuf -e pgpkeys.mit.edu         ha.pool.sks-keyservers.net         hkp://p80.pool.sks-keyservers.net:80         pgp.mit.edu) ; do     gpg --batch --keyserver $server --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 && break || : ;     done;     gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu;     rm -rf \"$GNUPGHOME\" /usr/local/bin/gosu.asc;     chmod +x /usr/local/bin/gosu;     gosu nobody true;     # install tini","raw":"wget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/${GOSU_VERSION}/gosu-$dpkgArch\";     wget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\";     export GNUPGHOME=\"$(mktemp -d)\";     echo \"disable-ipv6\" >> ${GNUPGHOME}/dirmngr.conf;     for server in $(shuf -e pgpkeys.mit.edu         ha.pool.sks-keyservers.net         hkp://p80.pool.sks-keyservers.net:80         pgp.mit.edu) ; do     gpg --batch --keyserver $server --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 && break || : ;     done;     gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu;     rm -rf \"$GNUPGHOME\" /usr/local/bin/gosu.asc;     chmod +x /usr/local/bin/gosu;     gosu nobody true;     # install tini"},{"name":"WGET","lineno":74,"args":"-O /usr/local/bin/tini \"https://github.com/krallin/tini/releases/download/v${TINI_VERSION}/tini-$dpkgArch\";     wget -O /usr/local/bin/tini.asc \"https://github.com/krallin/tini/releases/download/v${TINI_VERSION}/tini-$dpkgArch.asc\";     export GNUPGHOME=\"$(mktemp -d)\";     echo \"disable-ipv6\" >> ${GNUPGHOME}/dirmngr.conf;     for server in $(shuf -e pgpkeys.mit.edu         ha.pool.sks-keyservers.net         hkp://p80.pool.sks-keyservers.net:80         pgp.mit.edu) ; do     gpg --batch --keyserver $server --recv-keys 595E85A6B1B4779EA4DAAEC70B588DFF0527A9B7 && break || : ;     done;     gpg --batch --verify /usr/local/bin/tini.asc /usr/local/bin/tini;     rm -rf \"$GNUPGHOME\" /usr/local/bin/tini.asc;     chmod +x /usr/local/bin/tini;     apt-get purge -y --auto-remove wget;     tini --version","raw":"wget -O /usr/local/bin/tini \"https://github.com/krallin/tini/releases/download/v${TINI_VERSION}/tini-$dpkgArch\";     wget -O /usr/local/bin/tini.asc \"https://github.com/krallin/tini/releases/download/v${TINI_VERSION}/tini-$dpkgArch.asc\";     export GNUPGHOME=\"$(mktemp -d)\";     echo \"disable-ipv6\" >> ${GNUPGHOME}/dirmngr.conf;     for server in $(shuf -e pgpkeys.mit.edu         ha.pool.sks-keyservers.net         hkp://p80.pool.sks-keyservers.net:80         pgp.mit.edu) ; do     gpg --batch --keyserver $server --recv-keys 595E85A6B1B4779EA4DAAEC70B588DFF0527A9B7 && break || : ;     done;     gpg --batch --verify /usr/local/bin/tini.asc /usr/local/bin/tini;     rm -rf \"$GNUPGHOME\" /usr/local/bin/tini.asc;     chmod +x /usr/local/bin/tini;     apt-get purge -y --auto-remove wget;     tini --version"},{"name":"ENV","lineno":78,"args":{"GPG_COUCH_KEY":"# gpg: key D401AB61: public key \"Bintray (by JFrog) <bintray@bintray.com> imported"},"raw":"ENV GPG_COUCH_KEY # gpg: key D401AB61: public key \"Bintray (by JFrog) <bintray@bintray.com> imported"},{"name":"8756C4F765C9AC3CB6B85D62379CE192D401AB61","lineno":79,"args":"","raw":"8756C4F765C9AC3CB6B85D62379CE192D401AB61"},{"name":"RUN","lineno":92,"args":"set -xe;     export GNUPGHOME=\"$(mktemp -d)\";     echo \"disable-ipv6\" >> ${GNUPGHOME}/dirmngr.conf;     for server in $(shuf -e pgpkeys.mit.edu         ha.pool.sks-keyservers.net         hkp://p80.pool.sks-keyservers.net:80         pgp.mit.edu) ; do         gpg --batch --keyserver $server --recv-keys $GPG_COUCH_KEY && break || : ;     done;     gpg --batch --export $GPG_COUCH_KEY > /etc/apt/trusted.gpg.d/couchdb.gpg;     command -v gpgconf && gpgconf --kill all || :;     rm -rf \"$GNUPGHOME\";     apt-key list","raw":"RUN set -xe;     export GNUPGHOME=\"$(mktemp -d)\";     echo \"disable-ipv6\" >> ${GNUPGHOME}/dirmngr.conf;     for server in $(shuf -e pgpkeys.mit.edu         ha.pool.sks-keyservers.net         hkp://p80.pool.sks-keyservers.net:80         pgp.mit.edu) ; do         gpg --batch --keyserver $server --recv-keys $GPG_COUCH_KEY && break || : ;     done;     gpg --batch --export $GPG_COUCH_KEY > /etc/apt/trusted.gpg.d/couchdb.gpg;     command -v gpgconf && gpgconf --kill all || :;     rm -rf \"$GNUPGHOME\";     apt-key list"},{"name":"ENV","lineno":94,"args":{"COUCHDB_VERSION":"3.0.0"},"raw":"ENV COUCHDB_VERSION 3.0.0"},{"name":"RUN","lineno":96,"args":"echo \"deb https://apache.bintray.com/couchdb-deb buster main\" > /etc/apt/sources.list.d/couchdb.list","raw":"RUN echo \"deb https://apache.bintray.com/couchdb-deb buster main\" > /etc/apt/sources.list.d/couchdb.list"},{"name":"RUN","lineno":103,"args":"set -xe;     apt-get update;         echo \"couchdb couchdb/mode select none\" | debconf-set-selections; # we DO want recommends this time","raw":"RUN set -xe;     apt-get update;         echo \"couchdb couchdb/mode select none\" | debconf-set-selections; # we DO want recommends this time"},{"name":"DEBIAN_FRONTEND=NONINTERACTIVE","lineno":107,"args":"apt-get install -y --allow-downgrades --allow-remove-essential --allow-change-held-packages             couchdb=\"$COUCHDB_VERSION\"~buster     ; # Undo symlinks to /var/log and /var/lib","raw":"DEBIAN_FRONTEND=noninteractive apt-get install -y --allow-downgrades --allow-remove-essential --allow-change-held-packages             couchdb=\"$COUCHDB_VERSION\"~buster     ; # Undo symlinks to /var/log and /var/lib"},{"name":"RMDIR","lineno":113,"args":"/var/lib/couchdb /var/log/couchdb;     rm /opt/couchdb/data /opt/couchdb/var/log;     mkdir -p /opt/couchdb/data /opt/couchdb/var/log;     chown couchdb:couchdb /opt/couchdb/data /opt/couchdb/var/log;     chmod 777 /opt/couchdb/data /opt/couchdb/var/log; # Remove file that sets logging to a file","raw":"rmdir /var/lib/couchdb /var/log/couchdb;     rm /opt/couchdb/data /opt/couchdb/var/log;     mkdir -p /opt/couchdb/data /opt/couchdb/var/log;     chown couchdb:couchdb /opt/couchdb/data /opt/couchdb/var/log;     chmod 777 /opt/couchdb/data /opt/couchdb/var/log; # Remove file that sets logging to a file"},{"name":"RM","lineno":115,"args":"/opt/couchdb/etc/default.d/10-filelog.ini; # Check we own everything in /opt/couchdb. Matches the command in dockerfile_entrypoint.sh","raw":"rm /opt/couchdb/etc/default.d/10-filelog.ini; # Check we own everything in /opt/couchdb. Matches the command in dockerfile_entrypoint.sh"},{"name":"FIND","lineno":117,"args":"/opt/couchdb \\! \\( -user couchdb -group couchdb \\) -exec chown -f couchdb:couchdb '{}' +; # Setup directories and permissions for config. Technically these could be 555 and 444 respectively","raw":"find /opt/couchdb \\! \\( -user couchdb -group couchdb \\) -exec chown -f couchdb:couchdb '{}' +; # Setup directories and permissions for config. Technically these could be 555 and 444 respectively"},{"name":"FIND","lineno":121,"args":"/opt/couchdb/etc -type d ! -perm 0755 -exec chmod -f 0755 '{}' +;     find /opt/couchdb/etc -type f ! -perm 0644 -exec chmod -f 0644 '{}' +; # only local.d needs to be writable for the docker_entrypoint.sh","raw":"find /opt/couchdb/etc -type d ! -perm 0755 -exec chmod -f 0755 '{}' +;     find /opt/couchdb/etc -type f ! -perm 0644 -exec chmod -f 0644 '{}' +; # only local.d needs to be writable for the docker_entrypoint.sh"},{"name":"CHMOD","lineno":123,"args":"-f 0777 /opt/couchdb/etc/local.d; # apt clean-up","raw":"chmod -f 0777 /opt/couchdb/etc/local.d; # apt clean-up"},{"name":"RM","lineno":124,"args":"-rf /var/lib/apt/lists/*;","raw":"rm -rf /var/lib/apt/lists/*;"},{"name":"COPY","lineno":127,"args":["--chown=couchdb:couchdb","10-docker-default.ini","/opt/couchdb/etc/default.d/"],"raw":"COPY --chown=couchdb:couchdb 10-docker-default.ini /opt/couchdb/etc/default.d/"},{"name":"COPY","lineno":128,"args":["--chown=couchdb:couchdb","vm.args","/opt/couchdb/etc/"],"raw":"COPY --chown=couchdb:couchdb vm.args /opt/couchdb/etc/"},{"name":"COPY","lineno":130,"args":["docker-entrypoint.sh","/usr/local/bin"],"raw":"COPY docker-entrypoint.sh /usr/local/bin"},{"name":"RUN","lineno":131,"args":"ln -s usr/local/bin/docker-entrypoint.sh /docker-entrypoint.sh # backwards compat","raw":"RUN ln -s usr/local/bin/docker-entrypoint.sh /docker-entrypoint.sh # backwards compat"},{"name":"ENTRYPOINT","lineno":132,"args":["tini","--","/docker-entrypoint.sh"],"raw":"ENTRYPOINT [\"tini\", \"--\", \"/docker-entrypoint.sh\"]"},{"name":"VOLUME","lineno":134,"args":["/opt/couchdb/data"],"raw":"VOLUME /opt/couchdb/data"},{"name":"EXPOSE","lineno":139,"args":["5984","4369","9100"],"raw":"EXPOSE 5984 4369 9100"},{"name":"CMD","lineno":140,"args":["/opt/couchdb/bin/couchdb"],"raw":"CMD [\"/opt/couchdb/bin/couchdb\"]"}]}