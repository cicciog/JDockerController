{"docker":[{"name":"FROM","lineno":1,"args":"debian:buster-slim","raw":"FROM debian:buster-slim"},{"name":"ENV","lineno":6,"args":{"HTTPD_PREFIX":"/usr/local/apache2"},"raw":"ENV HTTPD_PREFIX /usr/local/apache2"},{"name":"ENV","lineno":7,"args":{"PATH":"$HTTPD_PREFIX/bin:$PATH"},"raw":"ENV PATH $HTTPD_PREFIX/bin:$PATH"},{"name":"RUN","lineno":9,"args":"mkdir -p \"$HTTPD_PREFIX\" \t&& chown www-data:www-data \"$HTTPD_PREFIX\"","raw":"RUN mkdir -p \"$HTTPD_PREFIX\" \t&& chown www-data:www-data \"$HTTPD_PREFIX\""},{"name":"WORKDIR","lineno":10,"args":"$HTTPD_PREFIX","raw":"WORKDIR $HTTPD_PREFIX"},{"name":"RUN","lineno":21,"args":"set -eux; \tapt-get update; \tapt-get install -y --no-install-recommends \t\tlibapr1-dev \t\tlibaprutil1-dev \t\tlibaprutil1-ldap \t; \trm -rf /var/lib/apt/lists/*","raw":"RUN set -eux; \tapt-get update; \tapt-get install -y --no-install-recommends \t\tlibapr1-dev \t\tlibaprutil1-dev \t\tlibaprutil1-ldap \t; \trm -rf /var/lib/apt/lists/*"},{"name":"ENV","lineno":23,"args":{"HTTPD_VERSION":"2.4.41"},"raw":"ENV HTTPD_VERSION 2.4.41"},{"name":"ENV","lineno":24,"args":{"HTTPD_SHA256":"133d48298fe5315ae9366a0ec66282fa4040efa5d566174481077ade7d18ea40"},"raw":"ENV HTTPD_SHA256 133d48298fe5315ae9366a0ec66282fa4040efa5d566174481077ade7d18ea40"},{"name":"ENV","lineno":27,"args":{"HTTPD_PATCHES":"\"\""},"raw":"ENV HTTPD_PATCHES=\"\""},{"name":"RUN","lineno":32,"args":"set -eux; \t\t# mod_http2 mod_lua mod_proxy_html mod_xml2enc","raw":"RUN set -eux; \t\t# mod_http2 mod_lua mod_proxy_html mod_xml2enc"},{"name":"ID=ADB6F181257AF28EE67AF15FC49D2699A0080D4C","lineno":34,"args":"","raw":"id=adb6f181257af28ee67af15fc49d2699a0080d4c"},{"name":"SAVEDAPTMARK=\"$(APT-MARK","lineno":64,"args":"showmanual)\"; \tapt-get update; \tapt-get install -y --no-install-recommends \t\tbzip2 \t\tca-certificates \t\tdirmngr \t\tdpkg-dev \t\tgcc \t\tgnupg \t\tlibbrotli-dev \t\tlibcurl4-openssl-dev \t\tlibjansson-dev \t\tliblua5.2-dev \t\tlibnghttp2-dev \t\tlibpcre3-dev \t\tlibssl-dev \t\tlibxml2-dev \t\tmake \t\twget \t\tzlib1g-dev \t; \trm -r /var/lib/apt/lists/*; \t\tddist() { \t\tlocal f=\"$1\"; shift; \t\tlocal distFile=\"$1\"; shift; \t\tlocal success=; \t\tlocal distUrl=; \t\tfor distUrl in # https://issues.apache.org/jira/browse/INFRA-8753","raw":"savedAptMark=\"$(apt-mark showmanual)\"; \tapt-get update; \tapt-get install -y --no-install-recommends \t\tbzip2 \t\tca-certificates \t\tdirmngr \t\tdpkg-dev \t\tgcc \t\tgnupg \t\tlibbrotli-dev \t\tlibcurl4-openssl-dev \t\tlibjansson-dev \t\tliblua5.2-dev \t\tlibnghttp2-dev \t\tlibpcre3-dev \t\tlibssl-dev \t\tlibxml2-dev \t\tmake \t\twget \t\tzlib1g-dev \t; \trm -r /var/lib/apt/lists/*; \t\tddist() { \t\tlocal f=\"$1\"; shift; \t\tlocal distFile=\"$1\"; shift; \t\tlocal success=; \t\tlocal distUrl=; \t\tfor distUrl in # https://issues.apache.org/jira/browse/INFRA-8753"},{"name":"FOCUSEDCOMMENTID=14735394#COMMENT-14735394","lineno":65,"args":"","raw":"focusedCommentId=14735394#comment-14735394"},{"name":"'HTTPS://WWW.APACHE.ORG/DYN/CLOSER.CGI","lineno":66,"args":"","raw":"'https://www.apache.org/dyn/closer.cgi"},{"name":"ACTION=DOWNLOAD&FILENAME='","lineno":68,"args":"# if the version is outdated (or we're grabbing the .asc file), we might have to pull from the dist/archive :/","raw":"action=download&filename=' # if the version is outdated (or we're grabbing the .asc file), we might have to pull from the dist/archive :/"},{"name":"HTTPS://WWW-US.APACHE.ORG/DIST/","lineno":84,"args":"https://www.apache.org/dist/ \t\t\thttps://archive.apache.org/dist/ \t\t; do \t\t\tif wget -O \"$f\" \"$distUrl$distFile\" && [ -s \"$f\" ]; then \t\t\t\tsuccess=1; \t\t\t\tbreak; \t\t\tfi; \t\tdone; \t\t[ -n \"$success\" ]; \t}; \t\tddist 'httpd.tar.bz2' \"httpd/httpd-$HTTPD_VERSION.tar.bz2\"; \techo \"$HTTPD_SHA256 *httpd.tar.bz2\" | sha256sum -c -; \t# see https://httpd.apache.org/download.cgi#verify","raw":"https://www-us.apache.org/dist/ \t\t\thttps://www.apache.org/dist/ \t\t\thttps://archive.apache.org/dist/ \t\t; do \t\t\tif wget -O \"$f\" \"$distUrl$distFile\" && [ -s \"$f\" ]; then \t\t\t\tsuccess=1; \t\t\t\tbreak; \t\t\tfi; \t\tdone; \t\t[ -n \"$success\" ]; \t}; \t\tddist 'httpd.tar.bz2' \"httpd/httpd-$HTTPD_VERSION.tar.bz2\"; \techo \"$HTTPD_SHA256 *httpd.tar.bz2\" | sha256sum -c -; \t# see https://httpd.apache.org/download.cgi#verify"},{"name":"DDIST","lineno":88,"args":"'httpd.tar.bz2.asc' \"httpd/httpd-$HTTPD_VERSION.tar.bz2.asc\"; \texport GNUPGHOME=\"$(mktemp -d)\"; \tfor key in # gpg: key 791485A8: public key \"Jim Jagielski (Release Signing Key) <jim@apache.org>\" imported","raw":"ddist 'httpd.tar.bz2.asc' \"httpd/httpd-$HTTPD_VERSION.tar.bz2.asc\"; \texport GNUPGHOME=\"$(mktemp -d)\"; \tfor key in # gpg: key 791485A8: public key \"Jim Jagielski (Release Signing Key) <jim@apache.org>\" imported"},{"name":"A93D62ECC3C8EA12DB220EC934EA76E6791485A8","lineno":90,"args":"# gpg: key 995E35221AD84DFF: public key \"Daniel Ruggeri (https://home.apache.org/~druggeri/) <druggeri@apache.org>\" imported","raw":"A93D62ECC3C8EA12DB220EC934EA76E6791485A8 # gpg: key 995E35221AD84DFF: public key \"Daniel Ruggeri (https://home.apache.org/~druggeri/) <druggeri@apache.org>\" imported"},{"name":"B9E8213AEFB861AF35A41F2C995E35221AD84DFF","lineno":125,"args":"; do \t\tgpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys \"$key\"; \tdone; \tgpg --batch --verify httpd.tar.bz2.asc httpd.tar.bz2; \tcommand -v gpgconf && gpgconf --kill all || :; \trm -rf \"$GNUPGHOME\" httpd.tar.bz2.asc; \t\tmkdir -p src; \ttar -xf httpd.tar.bz2 -C src --strip-components=1; \trm httpd.tar.bz2; \tcd src; \t\tpatches() { \t\twhile [ \"$#\" -gt 0 ]; do \t\t\tlocal patchFile=\"$1\"; shift; \t\t\tlocal patchSha256=\"$1\"; shift; \t\t\tddist \"$patchFile\" \"httpd/patches/apply_to_$HTTPD_VERSION/$patchFile\"; \t\t\techo \"$patchSha256 *$patchFile\" | sha256sum -c -; \t\t\tpatch -p0 < \"$patchFile\"; \t\t\trm -f \"$patchFile\"; \t\tdone; \t}; \tpatches $HTTPD_PATCHES; \t\tgnuArch=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\"; \tCFLAGS=\"$(dpkg-buildflags --get CFLAGS)\"; \tCPPFLAGS=\"$(dpkg-buildflags --get CPPFLAGS)\"; \tLDFLAGS=\"$(dpkg-buildflags --get LDFLAGS)\"; \t./configure \t\t--build=\"$gnuArch\" \t\t--prefix=\"$HTTPD_PREFIX\" \t\t--enable-mods-shared=reallyall \t\t--enable-mpms-shared=all # enable the same hardening flags as Debian","raw":"B9E8213AEFB861AF35A41F2C995E35221AD84DFF \t; do \t\tgpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys \"$key\"; \tdone; \tgpg --batch --verify httpd.tar.bz2.asc httpd.tar.bz2; \tcommand -v gpgconf && gpgconf --kill all || :; \trm -rf \"$GNUPGHOME\" httpd.tar.bz2.asc; \t\tmkdir -p src; \ttar -xf httpd.tar.bz2 -C src --strip-components=1; \trm httpd.tar.bz2; \tcd src; \t\tpatches() { \t\twhile [ \"$#\" -gt 0 ]; do \t\t\tlocal patchFile=\"$1\"; shift; \t\t\tlocal patchSha256=\"$1\"; shift; \t\t\tddist \"$patchFile\" \"httpd/patches/apply_to_$HTTPD_VERSION/$patchFile\"; \t\t\techo \"$patchSha256 *$patchFile\" | sha256sum -c -; \t\t\tpatch -p0 < \"$patchFile\"; \t\t\trm -f \"$patchFile\"; \t\tdone; \t}; \tpatches $HTTPD_PATCHES; \t\tgnuArch=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\"; \tCFLAGS=\"$(dpkg-buildflags --get CFLAGS)\"; \tCPPFLAGS=\"$(dpkg-buildflags --get CPPFLAGS)\"; \tLDFLAGS=\"$(dpkg-buildflags --get LDFLAGS)\"; \t./configure \t\t--build=\"$gnuArch\" \t\t--prefix=\"$HTTPD_PREFIX\" \t\t--enable-mods-shared=reallyall \t\t--enable-mpms-shared=all # enable the same hardening flags as Debian"},{"name":"--ENABLE-PIE","lineno":147,"args":"CFLAGS=\"-pipe $CFLAGS\" \t\tCPPFLAGS=\"$CPPFLAGS\" \t\tLDFLAGS=\"-Wl,--as-needed $LDFLAGS\" \t; \tmake -j \"$(nproc)\"; \tmake install; \t\tcd ..; \trm -r src man manual; \t\tsed -ri \t\t-e 's!^(\\s*CustomLog)\\s+\\S+!\\1 /proc/self/fd/1!g' \t\t-e 's!^(\\s*ErrorLog)\\s+\\S+!\\1 /proc/self/fd/2!g' \t\t-e 's!^(\\s*TransferLog)\\s+\\S+!\\1 /proc/self/fd/1!g' \t\t\"$HTTPD_PREFIX/conf/httpd.conf\" \t\t\"$HTTPD_PREFIX/conf/extra/httpd-ssl.conf\" \t; \t# reset apt-mark's \"manual\" list so that \"purge --auto-remove\" will remove all build dependencies","raw":"--enable-pie \t\tCFLAGS=\"-pipe $CFLAGS\" \t\tCPPFLAGS=\"$CPPFLAGS\" \t\tLDFLAGS=\"-Wl,--as-needed $LDFLAGS\" \t; \tmake -j \"$(nproc)\"; \tmake install; \t\tcd ..; \trm -r src man manual; \t\tsed -ri \t\t-e 's!^(\\s*CustomLog)\\s+\\S+!\\1 /proc/self/fd/1!g' \t\t-e 's!^(\\s*ErrorLog)\\s+\\S+!\\1 /proc/self/fd/2!g' \t\t-e 's!^(\\s*TransferLog)\\s+\\S+!\\1 /proc/self/fd/1!g' \t\t\"$HTTPD_PREFIX/conf/httpd.conf\" \t\t\"$HTTPD_PREFIX/conf/extra/httpd-ssl.conf\" \t; \t# reset apt-mark's \"manual\" list so that \"purge --auto-remove\" will remove all build dependencies"},{"name":"APT-MARK","lineno":160,"args":"auto '.*' > /dev/null; \t[ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark; \tfind /usr/local -type f -executable -exec ldd '{}' ';' \t\t| awk '/=>/ { print $(NF-1) }' \t\t| sort -u \t\t| xargs -r dpkg-query --search \t\t| cut -d: -f1 \t\t| sort -u \t\t| xargs -r apt-mark manual \t; \tapt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false; \t# smoke test","raw":"apt-mark auto '.*' > /dev/null; \t[ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark; \tfind /usr/local -type f -executable -exec ldd '{}' ';' \t\t| awk '/=>/ { print $(NF-1) }' \t\t| sort -u \t\t| xargs -r dpkg-query --search \t\t| cut -d: -f1 \t\t| sort -u \t\t| xargs -r apt-mark manual \t; \tapt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false; \t# smoke test"},{"name":"HTTPD","lineno":161,"args":"-v","raw":"httpd -v"},{"name":"STOPSIGNAL","lineno":164,"args":"SIGWINCH","raw":"STOPSIGNAL SIGWINCH"},{"name":"COPY","lineno":166,"args":["httpd-foreground","/usr/local/bin/"],"raw":"COPY httpd-foreground /usr/local/bin/"},{"name":"EXPOSE","lineno":168,"args":["80"],"raw":"EXPOSE 80"},{"name":"CMD","lineno":169,"args":["httpd-foreground"],"raw":"CMD [\"httpd-foreground\"]"}]}