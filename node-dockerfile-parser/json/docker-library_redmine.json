{"docker":[{"name":"FROM","lineno":1,"args":"ruby:2.6-slim-buster","raw":"FROM ruby:2.6-slim-buster"},{"name":"RUN","lineno":5,"args":"groupadd -r -g 999 redmine && useradd -r -g redmine -u 999 redmine","raw":"RUN groupadd -r -g 999 redmine && useradd -r -g redmine -u 999 redmine"},{"name":"RUN","lineno":19,"args":"set -eux; \tapt-get update; \tapt-get install -y --no-install-recommends \t\tca-certificates \t\twget \t\t\t\tbzr \t\tgit \t\tmercurial \t\topenssh-client \t\tsubversion \t\t# we need \"gsfonts\" for generating PNGs of Gantt charts","raw":"RUN set -eux; \tapt-get update; \tapt-get install -y --no-install-recommends \t\tca-certificates \t\twget \t\t\t\tbzr \t\tgit \t\tmercurial \t\topenssh-client \t\tsubversion \t\t# we need \"gsfonts\" for generating PNGs of Gantt charts"},{"name":"GHOSTSCRIPT","lineno":25,"args":"gsfonts \t\timagemagick \t; \trm -rf /var/lib/apt/lists/*","raw":"ghostscript \t\tgsfonts \t\timagemagick \t; \trm -rf /var/lib/apt/lists/*"},{"name":"RUN","lineno":38,"args":"set -eux; \tsavedAptMark=\"$(apt-mark showmanual)\"; \tapt-get update; \tapt-get install -y --no-install-recommends \t\tdirmngr \t\tgnupg \t; \trm -rf /var/lib/apt/lists/*; \t\tdpkgArch=\"$(dpkg --print-architecture | awk -F- '{ print $NF }')\"; \t# grab gosu for easy step-down from root","raw":"RUN set -eux; \tsavedAptMark=\"$(apt-mark showmanual)\"; \tapt-get update; \tapt-get install -y --no-install-recommends \t\tdirmngr \t\tgnupg \t; \trm -rf /var/lib/apt/lists/*; \t\tdpkgArch=\"$(dpkg --print-architecture | awk -F- '{ print $NF }')\"; \t# grab gosu for easy step-down from root"},{"name":"EXPORT","lineno":51,"args":"GOSU_VERSION='1.11'; \twget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch\"; \twget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\"; \texport GNUPGHOME=\"$(mktemp -d)\"; \tgpg --batch --keyserver hkps://keys.openpgp.org --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4; \tgpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu; \tgpgconf --kill all; \trm -r \"$GNUPGHOME\" /usr/local/bin/gosu.asc; \tchmod +x /usr/local/bin/gosu; \tgosu nobody true; \t# grab tini for signal processing and zombie killing","raw":"export GOSU_VERSION='1.11'; \twget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch\"; \twget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\"; \texport GNUPGHOME=\"$(mktemp -d)\"; \tgpg --batch --keyserver hkps://keys.openpgp.org --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4; \tgpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu; \tgpgconf --kill all; \trm -r \"$GNUPGHOME\" /usr/local/bin/gosu.asc; \tchmod +x /usr/local/bin/gosu; \tgosu nobody true; \t# grab tini for signal processing and zombie killing"},{"name":"EXPORT","lineno":64,"args":"TINI_VERSION='0.18.0'; \twget -O /usr/local/bin/tini \"https://github.com/krallin/tini/releases/download/v$TINI_VERSION/tini-$dpkgArch\"; \twget -O /usr/local/bin/tini.asc \"https://github.com/krallin/tini/releases/download/v$TINI_VERSION/tini-$dpkgArch.asc\"; \texport GNUPGHOME=\"$(mktemp -d)\"; \tgpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys 6380DC428747F6C393FEACA59A84159D7001A4E5; \tgpg --batch --verify /usr/local/bin/tini.asc /usr/local/bin/tini; \tgpgconf --kill all; \trm -r \"$GNUPGHOME\" /usr/local/bin/tini.asc; \tchmod +x /usr/local/bin/tini; \ttini -h; \t# reset apt-mark's \"manual\" list so that \"purge --auto-remove\" will remove all build dependencies","raw":"export TINI_VERSION='0.18.0'; \twget -O /usr/local/bin/tini \"https://github.com/krallin/tini/releases/download/v$TINI_VERSION/tini-$dpkgArch\"; \twget -O /usr/local/bin/tini.asc \"https://github.com/krallin/tini/releases/download/v$TINI_VERSION/tini-$dpkgArch.asc\"; \texport GNUPGHOME=\"$(mktemp -d)\"; \tgpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys 6380DC428747F6C393FEACA59A84159D7001A4E5; \tgpg --batch --verify /usr/local/bin/tini.asc /usr/local/bin/tini; \tgpgconf --kill all; \trm -r \"$GNUPGHOME\" /usr/local/bin/tini.asc; \tchmod +x /usr/local/bin/tini; \ttini -h; \t# reset apt-mark's \"manual\" list so that \"purge --auto-remove\" will remove all build dependencies"},{"name":"APT-MARK","lineno":67,"args":"auto '.*' > /dev/null; \t[ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark; \tapt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false","raw":"apt-mark auto '.*' > /dev/null; \t[ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark; \tapt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false"},{"name":"ENV","lineno":69,"args":{"RAILS_ENV":"production"},"raw":"ENV RAILS_ENV production"},{"name":"WORKDIR","lineno":70,"args":"/usr/src/redmine","raw":"WORKDIR /usr/src/redmine"},{"name":"ENV","lineno":74,"args":{"HOME":"/home/redmine"},"raw":"ENV HOME /home/redmine"},{"name":"RUN","lineno":79,"args":"set -eux; \t[ ! -d \"$HOME\" ]; \tmkdir -p \"$HOME\"; \tchown redmine:redmine \"$HOME\"; \tchmod 1777 \"$HOME\"","raw":"RUN set -eux; \t[ ! -d \"$HOME\" ]; \tmkdir -p \"$HOME\"; \tchown redmine:redmine \"$HOME\"; \tchmod 1777 \"$HOME\""},{"name":"ENV","lineno":81,"args":{"REDMINE_VERSION":"4.1.0"},"raw":"ENV REDMINE_VERSION 4.1.0"},{"name":"ENV","lineno":82,"args":{"REDMINE_DOWNLOAD_MD5":"32c7b9ce4c419092da439b540cbc1dbf"},"raw":"ENV REDMINE_DOWNLOAD_MD5 32c7b9ce4c419092da439b540cbc1dbf"},{"name":"RUN","lineno":91,"args":"set -eux; \twget -O redmine.tar.gz \"https://www.redmine.org/releases/redmine-${REDMINE_VERSION}.tar.gz\"; \techo \"$REDMINE_DOWNLOAD_MD5 *redmine.tar.gz\" | md5sum -c -; \ttar -xf redmine.tar.gz --strip-components=1; \trm redmine.tar.gz files/delete.me log/delete.me; \tmkdir -p log public/plugin_assets sqlite tmp/pdf tmp/pids; \tchown -R redmine:redmine ./; # log to STDOUT (https://github.com/docker-library/redmine/issues/108)","raw":"RUN set -eux; \twget -O redmine.tar.gz \"https://www.redmine.org/releases/redmine-${REDMINE_VERSION}.tar.gz\"; \techo \"$REDMINE_DOWNLOAD_MD5 *redmine.tar.gz\" | md5sum -c -; \ttar -xf redmine.tar.gz --strip-components=1; \trm redmine.tar.gz files/delete.me log/delete.me; \tmkdir -p log public/plugin_assets sqlite tmp/pdf tmp/pids; \tchown -R redmine:redmine ./; # log to STDOUT (https://github.com/docker-library/redmine/issues/108)"},{"name":"ECHO","lineno":93,"args":"'config.logger = Logger.new(STDOUT)' > config/additional_environment.rb; # fix permissions for running as an arbitrary user","raw":"echo 'config.logger = Logger.new(STDOUT)' > config/additional_environment.rb; # fix permissions for running as an arbitrary user"},{"name":"CHMOD","lineno":95,"args":"-R ugo=rwX config db sqlite; \tfind log tmp -type d -exec chmod 1777 '{}' +","raw":"chmod -R ugo=rwX config db sqlite; \tfind log tmp -type d -exec chmod 1777 '{}' +"},{"name":"RUN","lineno":120,"args":"set -eux; \t\tsavedAptMark=\"$(apt-mark showmanual)\"; \tapt-get update; \tapt-get install -y --no-install-recommends \t\tfreetds-dev \t\tgcc \t\tlibmariadbclient-dev \t\tlibpq-dev \t\tlibsqlite3-dev \t\tmake \t\tpatch \t; \trm -rf /var/lib/apt/lists/*; \t\tgosu redmine bundle install --jobs \"$(nproc)\" --without development test; \tfor adapter in mysql2 postgresql sqlserver sqlite3; do \t\techo \"$RAILS_ENV:\" > ./config/database.yml; \t\techo \"  adapter: $adapter\" >> ./config/database.yml; \t\tgosu redmine bundle install --jobs \"$(nproc)\" --without development test; \t\tcp Gemfile.lock \"Gemfile.lock.${adapter}\"; \tdone; \trm ./config/database.yml; # fix permissions for running as an arbitrary user","raw":"RUN set -eux; \t\tsavedAptMark=\"$(apt-mark showmanual)\"; \tapt-get update; \tapt-get install -y --no-install-recommends \t\tfreetds-dev \t\tgcc \t\tlibmariadbclient-dev \t\tlibpq-dev \t\tlibsqlite3-dev \t\tmake \t\tpatch \t; \trm -rf /var/lib/apt/lists/*; \t\tgosu redmine bundle install --jobs \"$(nproc)\" --without development test; \tfor adapter in mysql2 postgresql sqlserver sqlite3; do \t\techo \"$RAILS_ENV:\" > ./config/database.yml; \t\techo \"  adapter: $adapter\" >> ./config/database.yml; \t\tgosu redmine bundle install --jobs \"$(nproc)\" --without development test; \t\tcp Gemfile.lock \"Gemfile.lock.${adapter}\"; \tdone; \trm ./config/database.yml; # fix permissions for running as an arbitrary user"},{"name":"CHMOD","lineno":124,"args":"-R ugo=rwX Gemfile.lock \"$GEM_HOME\"; \trm -rf ~redmine/.bundle; \t# reset apt-mark's \"manual\" list so that \"purge --auto-remove\" will remove all build dependencies","raw":"chmod -R ugo=rwX Gemfile.lock \"$GEM_HOME\"; \trm -rf ~redmine/.bundle; \t# reset apt-mark's \"manual\" list so that \"purge --auto-remove\" will remove all build dependencies"},{"name":"APT-MARK","lineno":136,"args":"auto '.*' > /dev/null; \t[ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark; \tfind /usr/local -type f -executable -exec ldd '{}' ';' \t\t| awk '/=>/ { print $(NF-1) }' \t\t| sort -u \t\t| grep -v '^/usr/local/' \t\t| xargs -r dpkg-query --search \t\t| cut -d: -f1 \t\t| sort -u \t\t| xargs -r apt-mark manual \t; \tapt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false","raw":"apt-mark auto '.*' > /dev/null; \t[ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark; \tfind /usr/local -type f -executable -exec ldd '{}' ';' \t\t| awk '/=>/ { print $(NF-1) }' \t\t| sort -u \t\t| grep -v '^/usr/local/' \t\t| xargs -r dpkg-query --search \t\t| cut -d: -f1 \t\t| sort -u \t\t| xargs -r apt-mark manual \t; \tapt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false"},{"name":"VOLUME","lineno":138,"args":["/usr/src/redmine/files"],"raw":"VOLUME /usr/src/redmine/files"},{"name":"COPY","lineno":140,"args":["docker-entrypoint.sh","/"],"raw":"COPY docker-entrypoint.sh /"},{"name":"ENTRYPOINT","lineno":141,"args":["/docker-entrypoint.sh"],"raw":"ENTRYPOINT [\"/docker-entrypoint.sh\"]"},{"name":"EXPOSE","lineno":143,"args":["3000"],"raw":"EXPOSE 3000"},{"name":"CMD","lineno":144,"args":["rails","server","-b","0.0.0.0"],"raw":"CMD [\"rails\", \"server\", \"-b\", \"0.0.0.0\"]"}]}