{"docker":[{"name":"FROM","lineno":1,"args":"adoptopenjdk:8-jre-hotspot-bionic","raw":"FROM adoptopenjdk:8-jre-hotspot-bionic"},{"name":"RUN","lineno":6,"args":"set -eux; \tgroupadd -r cassandra --gid=999; \tuseradd -r -g cassandra --uid=999 cassandra","raw":"RUN set -eux; \tgroupadd -r cassandra --gid=999; \tuseradd -r -g cassandra --uid=999 cassandra"},{"name":"RUN","lineno":11,"args":"set -eux; \tapt-get update; \tapt-get install -y --no-install-recommends # solves warning: \"jemalloc shared library could not be preloaded to speed up memory allocations\"","raw":"RUN set -eux; \tapt-get update; \tapt-get install -y --no-install-recommends # solves warning: \"jemalloc shared library could not be preloaded to speed up memory allocations\""},{"name":"LIBJEMALLOC1","lineno":13,"args":"# \"free\" is used by cassandra-env.sh","raw":"libjemalloc1 # \"free\" is used by cassandra-env.sh"},{"name":"PROCPS","lineno":15,"args":"# \"cqlsh\" needs a python interpreter","raw":"procps # \"cqlsh\" needs a python interpreter"},{"name":"PYTHON","lineno":17,"args":"# \"ip\" is not required by Cassandra itself, but is commonly used in scripting Cassandra's configuration (since it is so fixated on explicit IP addresses)","raw":"python # \"ip\" is not required by Cassandra itself, but is commonly used in scripting Cassandra's configuration (since it is so fixated on explicit IP addresses)"},{"name":"IPROUTE2","lineno":19,"args":"# Cassandra will automatically use numactl if available","raw":"iproute2 # Cassandra will automatically use numactl if available"},{"name":"NUMACTL","lineno":24,"args":"; \trm -rf /var/lib/apt/lists/*","raw":"numactl \t; \trm -rf /var/lib/apt/lists/*"},{"name":"ENV","lineno":27,"args":{"GOSU_VERSION":"1.11"},"raw":"ENV GOSU_VERSION 1.11"},{"name":"RUN","lineno":46,"args":"set -eux; \tsavedAptMark=\"$(apt-mark showmanual)\"; \tapt-get update; \tapt-get install -y --no-install-recommends ca-certificates dirmngr gnupg wget; \trm -rf /var/lib/apt/lists/*; \tdpkgArch=\"$(dpkg --print-architecture | awk -F- '{ print $NF }')\"; \twget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch\"; \twget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\"; \texport GNUPGHOME=\"$(mktemp -d)\"; \tgpg --batch --keyserver hkps://keys.openpgp.org --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4; \tgpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu; \tgpgconf --kill all; \trm -rf \"$GNUPGHOME\" /usr/local/bin/gosu.asc; \tapt-mark auto '.*' > /dev/null; \t[ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark > /dev/null; \tapt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false; \tchmod +x /usr/local/bin/gosu; \tgosu --version; \tgosu nobody true","raw":"RUN set -eux; \tsavedAptMark=\"$(apt-mark showmanual)\"; \tapt-get update; \tapt-get install -y --no-install-recommends ca-certificates dirmngr gnupg wget; \trm -rf /var/lib/apt/lists/*; \tdpkgArch=\"$(dpkg --print-architecture | awk -F- '{ print $NF }')\"; \twget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch\"; \twget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\"; \texport GNUPGHOME=\"$(mktemp -d)\"; \tgpg --batch --keyserver hkps://keys.openpgp.org --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4; \tgpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu; \tgpgconf --kill all; \trm -rf \"$GNUPGHOME\" /usr/local/bin/gosu.asc; \tapt-mark auto '.*' > /dev/null; \t[ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark > /dev/null; \tapt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false; \tchmod +x /usr/local/bin/gosu; \tgosu --version; \tgosu nobody true"},{"name":"ENV","lineno":48,"args":{"CASSANDRA_HOME":"/opt/cassandra"},"raw":"ENV CASSANDRA_HOME /opt/cassandra"},{"name":"ENV","lineno":49,"args":{"CASSANDRA_CONF":"/etc/cassandra"},"raw":"ENV CASSANDRA_CONF /etc/cassandra"},{"name":"ENV","lineno":50,"args":{"PATH":"$CASSANDRA_HOME/bin:$PATH"},"raw":"ENV PATH $CASSANDRA_HOME/bin:$PATH"},{"name":"ENV","lineno":54,"args":{"GPG_KEYS":"# gpg: key 0353B12C: public key \"T Jake Luciani <jake@apache.org>\" imported"},"raw":"ENV GPG_KEYS # gpg: key 0353B12C: public key \"T Jake Luciani <jake@apache.org>\" imported"},{"name":"514A2AD631A57A16DD0047EC749D6EEC0353B12C","lineno":56,"args":"# gpg: key FE4B2BDA: public key \"Michael Shuler <michael@pbandjelly.org>\" imported","raw":"514A2AD631A57A16DD0047EC749D6EEC0353B12C # gpg: key FE4B2BDA: public key \"Michael Shuler <michael@pbandjelly.org>\" imported"},{"name":"A26E528B271F19B9E5D8E19EA278B781FE4B2BDA","lineno":58,"args":"# gpg: key E91335D77E3E87CB: public key \"Michael Semb Wever <mick@thelastpickle.com>\" imported","raw":"A26E528B271F19B9E5D8E19EA278B781FE4B2BDA # gpg: key E91335D77E3E87CB: public key \"Michael Semb Wever <mick@thelastpickle.com>\" imported"},{"name":"A4C465FEA0C552561A392A61E91335D77E3E87CB","lineno":59,"args":"","raw":"A4C465FEA0C552561A392A61E91335D77E3E87CB"},{"name":"ENV","lineno":61,"args":{"CASSANDRA_VERSION":"3.0.20"},"raw":"ENV CASSANDRA_VERSION 3.0.20"},{"name":"ENV","lineno":62,"args":{"CASSANDRA_SHA512":"1a96db1f26cb31e3d04cb67791d4055515b0ea434e0fa2fb2445d44a180c71e7ca5c6436c27059e44b398f623c9623a8fa67d60a084219f0938f9528cd0c1634"},"raw":"ENV CASSANDRA_SHA512 1a96db1f26cb31e3d04cb67791d4055515b0ea434e0fa2fb2445d44a180c71e7ca5c6436c27059e44b398f623c9623a8fa67d60a084219f0938f9528cd0c1634"},{"name":"RUN","lineno":76,"args":"set -eux; \tsavedAptMark=\"$(apt-mark showmanual)\"; \tapt-get update; \tapt-get install -y --no-install-recommends ca-certificates dirmngr gnupg wget; \trm -rf /var/lib/apt/lists/*; \t\tddist() { \t\tlocal f=\"$1\"; shift; \t\tlocal distFile=\"$1\"; shift; \t\tlocal success=; \t\tlocal distUrl=; \t\tfor distUrl in # https://issues.apache.org/jira/browse/INFRA-8753","raw":"RUN set -eux; \tsavedAptMark=\"$(apt-mark showmanual)\"; \tapt-get update; \tapt-get install -y --no-install-recommends ca-certificates dirmngr gnupg wget; \trm -rf /var/lib/apt/lists/*; \t\tddist() { \t\tlocal f=\"$1\"; shift; \t\tlocal distFile=\"$1\"; shift; \t\tlocal success=; \t\tlocal distUrl=; \t\tfor distUrl in # https://issues.apache.org/jira/browse/INFRA-8753"},{"name":"FOCUSEDCOMMENTID=14735394#COMMENT-14735394","lineno":77,"args":"","raw":"focusedCommentId=14735394#comment-14735394"},{"name":"'HTTPS://WWW.APACHE.ORG/DYN/CLOSER.CGI","lineno":78,"args":"","raw":"'https://www.apache.org/dyn/closer.cgi"},{"name":"ACTION=DOWNLOAD&FILENAME='","lineno":80,"args":"# if the version is outdated (or we're grabbing the .asc file), we might have to pull from the dist/archive :/","raw":"action=download&filename=' # if the version is outdated (or we're grabbing the .asc file), we might have to pull from the dist/archive :/"},{"name":"HTTPS://WWW-US.APACHE.ORG/DIST/","lineno":119,"args":"https://www.apache.org/dist/ \t\t\thttps://archive.apache.org/dist/ \t\t; do \t\t\tif wget --progress=dot:giga -O \"$f\" \"$distUrl$distFile\" && [ -s \"$f\" ]; then \t\t\t\tsuccess=1; \t\t\t\tbreak; \t\t\tfi; \t\tdone; \t\t[ -n \"$success\" ]; \t}; \t\tddist 'cassandra-bin.tgz' \"cassandra/$CASSANDRA_VERSION/apache-cassandra-$CASSANDRA_VERSION-bin.tar.gz\"; \techo \"$CASSANDRA_SHA512 *cassandra-bin.tgz\" | sha512sum --check --strict -; \t\tddist 'cassandra-bin.tgz.asc' \"cassandra/$CASSANDRA_VERSION/apache-cassandra-$CASSANDRA_VERSION-bin.tar.gz.asc\"; \texport GNUPGHOME=\"$(mktemp -d)\"; \tfor key in $GPG_KEYS; do \t\tgpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys \"$key\"; \tdone; \tgpg --batch --verify cassandra-bin.tgz.asc cassandra-bin.tgz; \trm -rf \"$GNUPGHOME\"; \t\tapt-mark auto '.*' > /dev/null; \t[ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark > /dev/null; \tapt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false; \t\tmkdir -p \"$CASSANDRA_HOME\"; \ttar --extract --file cassandra-bin.tgz --directory \"$CASSANDRA_HOME\" --strip-components 1; \trm cassandra-bin.tgz*; \t\t[ ! -e \"$CASSANDRA_CONF\" ]; \tmv \"$CASSANDRA_HOME/conf\" \"$CASSANDRA_CONF\"; \tln -sT \"$CASSANDRA_CONF\" \"$CASSANDRA_HOME/conf\"; \t\tdpkgArch=\"$(dpkg --print-architecture)\"; \tcase \"$dpkgArch\" in \t\tppc64el) # https://issues.apache.org/jira/browse/CASSANDRA-13345","raw":"https://www-us.apache.org/dist/ \t\t\thttps://www.apache.org/dist/ \t\t\thttps://archive.apache.org/dist/ \t\t; do \t\t\tif wget --progress=dot:giga -O \"$f\" \"$distUrl$distFile\" && [ -s \"$f\" ]; then \t\t\t\tsuccess=1; \t\t\t\tbreak; \t\t\tfi; \t\tdone; \t\t[ -n \"$success\" ]; \t}; \t\tddist 'cassandra-bin.tgz' \"cassandra/$CASSANDRA_VERSION/apache-cassandra-$CASSANDRA_VERSION-bin.tar.gz\"; \techo \"$CASSANDRA_SHA512 *cassandra-bin.tgz\" | sha512sum --check --strict -; \t\tddist 'cassandra-bin.tgz.asc' \"cassandra/$CASSANDRA_VERSION/apache-cassandra-$CASSANDRA_VERSION-bin.tar.gz.asc\"; \texport GNUPGHOME=\"$(mktemp -d)\"; \tfor key in $GPG_KEYS; do \t\tgpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys \"$key\"; \tdone; \tgpg --batch --verify cassandra-bin.tgz.asc cassandra-bin.tgz; \trm -rf \"$GNUPGHOME\"; \t\tapt-mark auto '.*' > /dev/null; \t[ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark > /dev/null; \tapt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false; \t\tmkdir -p \"$CASSANDRA_HOME\"; \ttar --extract --file cassandra-bin.tgz --directory \"$CASSANDRA_HOME\" --strip-components 1; \trm cassandra-bin.tgz*; \t\t[ ! -e \"$CASSANDRA_CONF\" ]; \tmv \"$CASSANDRA_HOME/conf\" \"$CASSANDRA_CONF\"; \tln -sT \"$CASSANDRA_CONF\" \"$CASSANDRA_HOME/conf\"; \t\tdpkgArch=\"$(dpkg --print-architecture)\"; \tcase \"$dpkgArch\" in \t\tppc64el) # https://issues.apache.org/jira/browse/CASSANDRA-13345"},{"name":"IF","lineno":122,"args":"grep -q -- '^-Xss' \"$CASSANDRA_CONF/jvm.options\"; then # 3.11+ (jvm.options)","raw":"if grep -q -- '^-Xss' \"$CASSANDRA_CONF/jvm.options\"; then # 3.11+ (jvm.options)"},{"name":"GREP","lineno":127,"args":"-- '^-Xss256k$' \"$CASSANDRA_CONF/jvm.options\"; \t\t\t\tsed -ri 's/^-Xss256k$/-Xss512k/' \"$CASSANDRA_CONF/jvm.options\"; \t\t\t\tgrep -- '^-Xss512k$' \"$CASSANDRA_CONF/jvm.options\"; \t\t\telif grep -q -- '-Xss256k' \"$CASSANDRA_CONF/cassandra-env.sh\"; then # 3.0 (cassandra-env.sh)","raw":"grep -- '^-Xss256k$' \"$CASSANDRA_CONF/jvm.options\"; \t\t\t\tsed -ri 's/^-Xss256k$/-Xss512k/' \"$CASSANDRA_CONF/jvm.options\"; \t\t\t\tgrep -- '^-Xss512k$' \"$CASSANDRA_CONF/jvm.options\"; \t\t\telif grep -q -- '-Xss256k' \"$CASSANDRA_CONF/cassandra-env.sh\"; then # 3.0 (cassandra-env.sh)"},{"name":"SED","lineno":140,"args":"-ri 's/-Xss256k/-Xss512k/g' \"$CASSANDRA_CONF/cassandra-env.sh\"; \t\t\t\tgrep -- '-Xss512k' \"$CASSANDRA_CONF/cassandra-env.sh\"; \t\t\tfi; \t\t\t;; \tesac; \t\tmkdir -p \"$CASSANDRA_CONF\" /var/lib/cassandra /var/log/cassandra; \tchown -R cassandra:cassandra \"$CASSANDRA_CONF\" /var/lib/cassandra /var/log/cassandra; \tchmod 777 \"$CASSANDRA_CONF\" /var/lib/cassandra /var/log/cassandra; \tln -sT /var/lib/cassandra \"$CASSANDRA_HOME/data\"; \tln -sT /var/log/cassandra \"$CASSANDRA_HOME/logs\"; \t# smoke test","raw":"sed -ri 's/-Xss256k/-Xss512k/g' \"$CASSANDRA_CONF/cassandra-env.sh\"; \t\t\t\tgrep -- '-Xss512k' \"$CASSANDRA_CONF/cassandra-env.sh\"; \t\t\tfi; \t\t\t;; \tesac; \t\tmkdir -p \"$CASSANDRA_CONF\" /var/lib/cassandra /var/log/cassandra; \tchown -R cassandra:cassandra \"$CASSANDRA_CONF\" /var/lib/cassandra /var/log/cassandra; \tchmod 777 \"$CASSANDRA_CONF\" /var/lib/cassandra /var/log/cassandra; \tln -sT /var/lib/cassandra \"$CASSANDRA_HOME/data\"; \tln -sT /var/log/cassandra \"$CASSANDRA_HOME/logs\"; \t# smoke test"},{"name":"CASSANDRA","lineno":141,"args":"-v","raw":"cassandra -v"},{"name":"VOLUME","lineno":143,"args":["/var/lib/cassandra"],"raw":"VOLUME /var/lib/cassandra"},{"name":"COPY","lineno":145,"args":["docker-entrypoint.sh","/usr/local/bin/"],"raw":"COPY docker-entrypoint.sh /usr/local/bin/"},{"name":"RUN","lineno":146,"args":"ln -s usr/local/bin/docker-entrypoint.sh /docker-entrypoint.sh # backwards compat","raw":"RUN ln -s usr/local/bin/docker-entrypoint.sh /docker-entrypoint.sh # backwards compat"},{"name":"ENTRYPOINT","lineno":147,"args":["docker-entrypoint.sh"],"raw":"ENTRYPOINT [\"docker-entrypoint.sh\"]"},{"name":"EXPOSE","lineno":154,"args":["7000","7001","7199","9042","9160"],"raw":"EXPOSE 7000 7001 7199 9042 9160"},{"name":"CMD","lineno":155,"args":["cassandra","-f"],"raw":"CMD [\"cassandra\", \"-f\"]"}]}