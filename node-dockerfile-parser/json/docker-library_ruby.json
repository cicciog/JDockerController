{"docker":[{"name":"FROM","lineno":1,"args":"alpine:3.11","raw":"FROM alpine:3.11"},{"name":"RUN","lineno":4,"args":"apk add --no-cache \t\tgmp-dev","raw":"RUN apk add --no-cache \t\tgmp-dev"},{"name":"RUN","lineno":12,"args":"set -eux; \tmkdir -p /usr/local/etc; \t{ \t\techo 'install: --no-document'; \t\techo 'update: --no-document'; \t} >> /usr/local/etc/gemrc","raw":"RUN set -eux; \tmkdir -p /usr/local/etc; \t{ \t\techo 'install: --no-document'; \t\techo 'update: --no-document'; \t} >> /usr/local/etc/gemrc"},{"name":"ENV","lineno":14,"args":{"RUBY_MAJOR":"2.7"},"raw":"ENV RUBY_MAJOR 2.7"},{"name":"ENV","lineno":15,"args":{"RUBY_VERSION":"2.7.0"},"raw":"ENV RUBY_VERSION 2.7.0"},{"name":"ENV","lineno":16,"args":{"RUBY_DOWNLOAD_SHA256":"27d350a52a02b53034ca0794efe518667d558f152656c2baaf08f3d0c8b02343"},"raw":"ENV RUBY_DOWNLOAD_SHA256 27d350a52a02b53034ca0794efe518667d558f152656c2baaf08f3d0c8b02343"},{"name":"RUN","lineno":61,"args":"set -eux; \t\tapk add --no-cache --virtual .ruby-builddeps \t\tautoconf \t\tbison \t\tbzip2 \t\tbzip2-dev \t\tca-certificates \t\tcoreutils \t\tdpkg-dev dpkg \t\tgcc \t\tgdbm-dev \t\tglib-dev \t\tlibc-dev \t\tlibffi-dev \t\tlibxml2-dev \t\tlibxslt-dev \t\tlinux-headers \t\tmake \t\tncurses-dev \t\topenssl \t\topenssl-dev \t\tprocps \t\treadline-dev \t\truby \t\ttar \t\txz \t\tyaml-dev \t\tzlib-dev \t; \t\twget -O ruby.tar.xz \"https://cache.ruby-lang.org/pub/ruby/${RUBY_MAJOR%-rc}/ruby-$RUBY_VERSION.tar.xz\"; \techo \"$RUBY_DOWNLOAD_SHA256 *ruby.tar.xz\" | sha256sum --check --strict; \t\tmkdir -p /usr/src/ruby; \ttar -xJf ruby.tar.xz -C /usr/src/ruby --strip-components=1; \trm ruby.tar.xz; \t\tcd /usr/src/ruby; \t# https://github.com/docker-library/ruby/issues/196","raw":"RUN set -eux; \t\tapk add --no-cache --virtual .ruby-builddeps \t\tautoconf \t\tbison \t\tbzip2 \t\tbzip2-dev \t\tca-certificates \t\tcoreutils \t\tdpkg-dev dpkg \t\tgcc \t\tgdbm-dev \t\tglib-dev \t\tlibc-dev \t\tlibffi-dev \t\tlibxml2-dev \t\tlibxslt-dev \t\tlinux-headers \t\tmake \t\tncurses-dev \t\topenssl \t\topenssl-dev \t\tprocps \t\treadline-dev \t\truby \t\ttar \t\txz \t\tyaml-dev \t\tzlib-dev \t; \t\twget -O ruby.tar.xz \"https://cache.ruby-lang.org/pub/ruby/${RUBY_MAJOR%-rc}/ruby-$RUBY_VERSION.tar.xz\"; \techo \"$RUBY_DOWNLOAD_SHA256 *ruby.tar.xz\" | sha256sum --check --strict; \t\tmkdir -p /usr/src/ruby; \ttar -xJf ruby.tar.xz -C /usr/src/ruby --strip-components=1; \trm ruby.tar.xz; \t\tcd /usr/src/ruby; \t# https://github.com/docker-library/ruby/issues/196"},{"name":"WGET","lineno":69,"args":"-O 'thread-stack-fix.patch' 'https://bugs.ruby-lang.org/attachments/download/7081/0001-thread_pthread.c-make-get_main_stack-portable-on-lin.patch'; \techo '3ab628a51d92fdf0d2b5835e93564857aea73e0c1de00313864a94a6255cb645 *thread-stack-fix.patch' | sha256sum --check --strict; \tpatch -p1 -i thread-stack-fix.patch; \trm thread-stack-fix.patch; \t# hack in \"ENABLE_PATH_CHECK\" disabling to suppress:","raw":"wget -O 'thread-stack-fix.patch' 'https://bugs.ruby-lang.org/attachments/download/7081/0001-thread_pthread.c-make-get_main_stack-portable-on-lin.patch'; \techo '3ab628a51d92fdf0d2b5835e93564857aea73e0c1de00313864a94a6255cb645 *thread-stack-fix.patch' | sha256sum --check --strict; \tpatch -p1 -i thread-stack-fix.patch; \trm thread-stack-fix.patch; \t# hack in \"ENABLE_PATH_CHECK\" disabling to suppress:"},{"name":"{","lineno":80,"args":"echo '#define ENABLE_PATH_CHECK 0'; \t\techo; \t\tcat file.c; \t} > file.c.new; \tmv file.c.new file.c; \t\tautoconf; \tgnuArch=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\"; # the configure script does not detect isnan/isinf as macros","raw":"{ \t\techo '#define ENABLE_PATH_CHECK 0'; \t\techo; \t\tcat file.c; \t} > file.c.new; \tmv file.c.new file.c; \t\tautoconf; \tgnuArch=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\"; # the configure script does not detect isnan/isinf as macros"},{"name":"EXPORT","lineno":109,"args":"ac_cv_func_isnan=yes ac_cv_func_isinf=yes; \t./configure \t\t--build=\"$gnuArch\" \t\t--disable-install-doc \t\t--enable-shared \t; \tmake -j \"$(nproc)\"; \tmake install; \t\trunDeps=\"$( \t\tscanelf --needed --nobanner --format '%n#p' --recursive /usr/local \t\t\t| tr ',' '\\n' \t\t\t| sort -u \t\t\t| awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' \t)\"; \tapk add --no-network --virtual .ruby-rundeps \t\t$runDeps \t\tbzip2 \t\tca-certificates \t\tlibffi-dev \t\tprocps \t\tyaml-dev \t\tzlib-dev \t; \tapk del --no-network .ruby-builddeps; \t\tcd /; \trm -r /usr/src/ruby; # verify we have no \"ruby\" packages installed","raw":"export ac_cv_func_isnan=yes ac_cv_func_isinf=yes; \t./configure \t\t--build=\"$gnuArch\" \t\t--disable-install-doc \t\t--enable-shared \t; \tmake -j \"$(nproc)\"; \tmake install; \t\trunDeps=\"$( \t\tscanelf --needed --nobanner --format '%n#p' --recursive /usr/local \t\t\t| tr ',' '\\n' \t\t\t| sort -u \t\t\t| awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' \t)\"; \tapk add --no-network --virtual .ruby-rundeps \t\t$runDeps \t\tbzip2 \t\tca-certificates \t\tlibffi-dev \t\tprocps \t\tyaml-dev \t\tzlib-dev \t; \tapk del --no-network .ruby-builddeps; \t\tcd /; \trm -r /usr/src/ruby; # verify we have no \"ruby\" packages installed"},{"name":"!","lineno":115,"args":"apk --no-network list --installed \t\t| grep -v '^[.]ruby-rundeps' \t\t| grep -i ruby \t; \t[ \"$(command -v ruby)\" = '/usr/local/bin/ruby' ]; # rough smoke test","raw":"! apk --no-network list --installed \t\t| grep -v '^[.]ruby-rundeps' \t\t| grep -i ruby \t; \t[ \"$(command -v ruby)\" = '/usr/local/bin/ruby' ]; # rough smoke test"},{"name":"RUBY","lineno":118,"args":"--version; \tgem --version; \tbundle --version","raw":"ruby --version; \tgem --version; \tbundle --version"},{"name":"ENV","lineno":121,"args":{"GEM_HOME":"/usr/local/bundle"},"raw":"ENV GEM_HOME /usr/local/bundle"},{"name":"ENV","lineno":123,"args":{"BUNDLE_SILENCE_ROOT_WARNING":"1","BUNDLE_APP_CONFIG":"\"$GEM_HOME\""},"raw":"ENV BUNDLE_SILENCE_ROOT_WARNING=1 \tBUNDLE_APP_CONFIG=\"$GEM_HOME\""},{"name":"ENV","lineno":124,"args":{"PATH":"$GEM_HOME/bin:$PATH"},"raw":"ENV PATH $GEM_HOME/bin:$PATH"},{"name":"RUN","lineno":126,"args":"mkdir -p \"$GEM_HOME\" && chmod 777 \"$GEM_HOME\"","raw":"RUN mkdir -p \"$GEM_HOME\" && chmod 777 \"$GEM_HOME\""},{"name":"CMD","lineno":128,"args":["irb"],"raw":"CMD [ \"irb\" ]"}]}