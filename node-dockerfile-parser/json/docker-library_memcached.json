{"docker":[{"name":"FROM","lineno":1,"args":"debian:buster-slim","raw":"FROM debian:buster-slim"},{"name":"RUN","lineno":4,"args":"groupadd --system --gid 11211 memcache && useradd --system --gid memcache --uid 11211 memcache","raw":"RUN groupadd --system --gid 11211 memcache && useradd --system --gid memcache --uid 11211 memcache"},{"name":"RUN","lineno":12,"args":"set -eux; \tapt-get update; \tapt-get install -y --no-install-recommends \t\tlibsasl2-modules \t; \trm -rf /var/lib/apt/lists/*","raw":"RUN set -eux; \tapt-get update; \tapt-get install -y --no-install-recommends \t\tlibsasl2-modules \t; \trm -rf /var/lib/apt/lists/*"},{"name":"ENV","lineno":14,"args":{"MEMCACHED_VERSION":"1.6.2"},"raw":"ENV MEMCACHED_VERSION 1.6.2"},{"name":"ENV","lineno":15,"args":{"MEMCACHED_SHA1":"a6a07f0433adaa13a3cafdf8c26acb640cdd001f"},"raw":"ENV MEMCACHED_SHA1 a6a07f0433adaa13a3cafdf8c26acb640cdd001f"},{"name":"RUN","lineno":45,"args":"set -x \t\t&& savedAptMark=\"$(apt-mark showmanual)\" \t&& apt-get update \t&& apt-get install -y --no-install-recommends \t\tca-certificates \t\tdpkg-dev \t\tgcc \t\tlibc6-dev \t\tlibevent-dev \t\tlibio-socket-ssl-perl \t\tlibsasl2-dev \t\tlibssl-dev \t\tmake \t\tperl \t\twget \t&& rm -rf /var/lib/apt/lists/* \t\t&& wget -O memcached.tar.gz \"https://memcached.org/files/memcached-$MEMCACHED_VERSION.tar.gz\" \t&& echo \"$MEMCACHED_SHA1  memcached.tar.gz\" | sha1sum -c - \t&& mkdir -p /usr/src/memcached \t&& tar -xzf memcached.tar.gz -C /usr/src/memcached --strip-components=1 \t&& rm memcached.tar.gz \t\t&& cd /usr/src/memcached \t\t&& gnuArch=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" \t&& enableExtstore=\"$( # https://github.com/docker-library/memcached/pull/38","raw":"RUN set -x \t\t&& savedAptMark=\"$(apt-mark showmanual)\" \t&& apt-get update \t&& apt-get install -y --no-install-recommends \t\tca-certificates \t\tdpkg-dev \t\tgcc \t\tlibc6-dev \t\tlibevent-dev \t\tlibio-socket-ssl-perl \t\tlibsasl2-dev \t\tlibssl-dev \t\tmake \t\tperl \t\twget \t&& rm -rf /var/lib/apt/lists/* \t\t&& wget -O memcached.tar.gz \"https://memcached.org/files/memcached-$MEMCACHED_VERSION.tar.gz\" \t&& echo \"$MEMCACHED_SHA1  memcached.tar.gz\" | sha1sum -c - \t&& mkdir -p /usr/src/memcached \t&& tar -xzf memcached.tar.gz -C /usr/src/memcached --strip-components=1 \t&& rm memcached.tar.gz \t\t&& cd /usr/src/memcached \t\t&& gnuArch=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" \t&& enableExtstore=\"$( # https://github.com/docker-library/memcached/pull/38"},{"name":"CASE","lineno":47,"args":"\"$gnuArch\" in # https://github.com/memcached/memcached/issues/381 \"--enable-extstore on s390x (IBM System Z mainframe architecture) fails tests\"","raw":"case \"$gnuArch\" in # https://github.com/memcached/memcached/issues/381 \"--enable-extstore on s390x (IBM System Z mainframe architecture) fails tests\""},{"name":"S390X-*)","lineno":60,"args":";; \t\t\t*) echo '--enable-extstore' ;; \t\tesac \t)\" \t&& ./configure \t\t--build=\"$gnuArch\" \t\t--enable-sasl \t\t--enable-sasl-pwdb \t\t--enable-tls \t\t$enableExtstore \t&& make -j \"$(nproc)\" \t# see https://github.com/docker-library/memcached/pull/54#issuecomment-562797748 and https://bugs.debian.org/927461 for why we have to munge openssl.cnf","raw":"s390x-*) ;; \t\t\t*) echo '--enable-extstore' ;; \t\tesac \t)\" \t&& ./configure \t\t--build=\"$gnuArch\" \t\t--enable-sasl \t\t--enable-sasl-pwdb \t\t--enable-tls \t\t$enableExtstore \t&& make -j \"$(nproc)\" \t# see https://github.com/docker-library/memcached/pull/54#issuecomment-562797748 and https://bugs.debian.org/927461 for why we have to munge openssl.cnf"},{"name":"&&","lineno":62,"args":"sed -i.bak 's/SECLEVEL=2/SECLEVEL=1/g' /etc/ssl/openssl.cnf # TODO https://github.com/memcached/memcached/issues/382 \"t/chunked-extstore.t is flaky on arm32v6\"","raw":"&& sed -i.bak 's/SECLEVEL=2/SECLEVEL=1/g' /etc/ssl/openssl.cnf # TODO https://github.com/memcached/memcached/issues/382 \"t/chunked-extstore.t is flaky on arm32v6\""},{"name":"&&","lineno":80,"args":"make test \t&& mv /etc/ssl/openssl.cnf.bak /etc/ssl/openssl.cnf \t&& make install \t\t&& cd / && rm -rf /usr/src/memcached \t\t&& apt-mark auto '.*' > /dev/null \t&& apt-mark manual $savedAptMark > /dev/null \t&& find /usr/local -type f -executable -exec ldd '{}' ';' \t\t| awk '/=>/ { print $(NF-1) }' \t\t| sort -u \t\t| xargs -r dpkg-query --search \t\t| cut -d: -f1 \t\t| sort -u \t\t| xargs -r apt-mark manual \t&& apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false \t\t&& memcached -V","raw":"&& make test \t&& mv /etc/ssl/openssl.cnf.bak /etc/ssl/openssl.cnf \t&& make install \t\t&& cd / && rm -rf /usr/src/memcached \t\t&& apt-mark auto '.*' > /dev/null \t&& apt-mark manual $savedAptMark > /dev/null \t&& find /usr/local -type f -executable -exec ldd '{}' ';' \t\t| awk '/=>/ { print $(NF-1) }' \t\t| sort -u \t\t| xargs -r dpkg-query --search \t\t| cut -d: -f1 \t\t| sort -u \t\t| xargs -r apt-mark manual \t&& apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false \t\t&& memcached -V"},{"name":"COPY","lineno":82,"args":["docker-entrypoint.sh","/usr/local/bin/"],"raw":"COPY docker-entrypoint.sh /usr/local/bin/"},{"name":"RUN","lineno":83,"args":"ln -s usr/local/bin/docker-entrypoint.sh /entrypoint.sh # backwards compat","raw":"RUN ln -s usr/local/bin/docker-entrypoint.sh /entrypoint.sh # backwards compat"},{"name":"ENTRYPOINT","lineno":84,"args":["docker-entrypoint.sh"],"raw":"ENTRYPOINT [\"docker-entrypoint.sh\"]"},{"name":"USER","lineno":86,"args":"memcache","raw":"USER memcache"},{"name":"EXPOSE","lineno":87,"args":["11211"],"raw":"EXPOSE 11211"},{"name":"CMD","lineno":88,"args":["memcached"],"raw":"CMD [\"memcached\"]"}]}